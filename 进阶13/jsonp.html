<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>进阶13-jsonp</title>
  <style type="text/css">

    .layout {
      padding-top: 50px;
      width: 487px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }

    .box {
      border-bottom: 1px solid #ccc;
      width: 250px;
      height: 19px;

    }
    .box2 {
        color: red;
    }
  </style>
</head>
<body>
    <div class="layout">
         <div class="box"></div>
         <button class='check'>随机查看歌曲</button>
         <button class="btn">下载歌曲</button>
    </div>
    <script type="text/javascript">
        var downLoad = document.querySelector('.btn');
        var box = document.querySelector('.box')
        var check = document.querySelector('.check');
        var body = document.querySelector('body');
        var layout = document.querySelector('.layout'); 

        check.addEventListener('click',append);
        downLoad.addEventListener('click',function(){
          if(box.innerText==='' || box.innerText === '请先查看要下载的歌曲'){
            box.innerText = '请先查看要下载的歌曲';
            box.style.color = "red";

          }else{
            window.location.href= downLoadUrl;
          }  
            
        })
        downLoad.addEventListener('click',function(e){
              e.stopPropagation();
        })       
        window.addEventListener('click',function(e){
             box.innerText = '';
             box.style.color = "";
           
        })

      
        function append(){
              scrNode = document.createElement('script');
              scrNode.src = 'http://api.jirengu.com/fm/getSong.php?channel=4&callback=getSong';
              body.appendChild(scrNode);
              body.removeChild(scrNode);
              console.log(scrNode);
        }

        function getSong(obj){
          var songName = obj.song[0].title;            
          var artist = obj.song[0].artist;
          downLoadUrl = obj.song[0].url;
          box.innerText = songName+'——'+artist;
        }

    </script>
</body>
</html>


